const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/knowledgeGraphService-pMLlB5D4.js","assets/js/test-Dp3_P59c.js","assets/js/index-CulM0VMq.js","assets/js/vendor-CHjNVy30.js","assets/css/index-DXVkK3IA.css","assets/js/station-CTe-uNfl.js","assets/css/test-D2ol9zJk.css","assets/js/networkEnums-2v9fEE2p.js","assets/js/FeatureSet-DR2_MLz0.js","assets/js/GPMessage-Bekmsege.js","assets/js/GraphQueryStreaming-5iEtxuCV.js"])))=>i.map(i=>d[i]);
import{a as q}from"./index-CulM0VMq.js";import{E as _,gk as w,gj as R,D as K,f6 as A,gl as I,gm as V,f as k,gn as J,eq as M,go as O,g2 as Q,g3 as B,cx as C}from"./test-Dp3_P59c.js";import{t as L}from"./arcade-DQIufeWi.js";import{a as P,p as T,x as z,q as W,j as D,i as H,y as b,z as U,A as X,E as Y,H as G}from"./aiServices-T_J52wdJ.js";import{a as c,r as u}from"./enum-DYiiI-Eb.js";import{l as Z}from"./portalUtils-d6mPY3_j.js";import{p as $,n as tt}from"./project-BASyrHIx.js";import{s as et,p as nt,e as rt,i as at,a as it}from"./GraphQueryStreaming-5iEtxuCV.js";import"./vendor-CHjNVy30.js";import"./station-CTe-uNfl.js";import"./TimeOnly-CSJYFsnz.js";import"./UnknownTimeZone-CD5-cTzw.js";import"./featureConversionUtils-BISEwGRc.js";import"./OptimizedFeature-99IiHQtf.js";import"./memoryEstimations-T_QTZf5l.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./FieldsIndex-dVB9L1ZQ.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-BCIYu5ka.js";import"./WhereClause-RDKtpLzj.js";import"./unitConversion-Ds5-GB5M.js";import"./number-BTw6xIXe.js";import"./commonProperties-DHiB1uzW.js";let l=null;async function ot(t){const e=M.geometryServiceUrl??"";if(!e){Q()||await B();for(const n of t)n.container[n.indexer]=C(n.container[n.indexer],k.WGS84);return}const r=t.map((n=>n.container[n.indexer])),i=new $({geometries:r,outSpatialReference:k.WGS84}),s=await tt(e,i);for(let n=0;n<s.length;n++){const a=t[n];a.container[a.indexer]=s[n]}}async function E(t,e){const r=new K({portal:t,id:e});return await r.load(),l===null&&(l=await q(()=>import("./knowledgeGraphService-pMLlB5D4.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),await l.fetchKnowledgeGraph(r.url)}function v(t,e,r,i,s){if(t===null)return null;if(w(t)||A(t))return t;if(b(t)||b(t))return t.toJSDate();if(U(t))return t.toStorageFormat();if(X(t))return t.toStorageString();if(Y(t)){const n={};for(const a of t.keys())n[a]=v(t.field(a),e,r,i,s),n[a]instanceof I&&s.push({container:n,indexer:a});return n}if(R(t)){const n=t.map((a=>v(a,e,r,i,s)));for(let a=0;a<n.length;a++)n[a]instanceof I&&s.push({container:n,indexer:a});return n}return G(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?V(t):t:void 0}function st(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return O(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new c(e,u.WrongSpatialReference,null)}function S(t,e){if(!t)return null;const r={};for(const i in t)r[i]=m(t[i],e);return r}function m(t,e){return t===null?null:R(t)?t.map((r=>m(r,e))):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:S(t.properties,e)}:t instanceof rt?{graphType:"object",properties:S(t.properties,e)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:S(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map((r=>m(r,e))):null}:G(t)?st(t,e):w(t)||A(t)||J(t)?t:null}function Et(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,r){return t.standardFunctionAsync(e,r,((i,s,n)=>{if(P(n,2,2,e,r),n[0]===null)throw new c(e,u.PortalRequired,r);if(n[0]instanceof L){const d=T(n[1]);let f;return f=e.services?.portal?e.services.portal:_.getDefault(),E(Z(n[0],f),d)}if(w(n[0])===!1)throw new c(e,u.InvalidParameter,r);const a=T(n[0]);return E(e.services?.portal??_.getDefault(),a)}))},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,r){return t.standardFunctionAsync(e,r,(async(i,s,n)=>{P(n,2,4,e,r);const a=n[0];if(!z(a))throw new c(e,u.InvalidParameter,r);const d=n[1];if(!w(d))throw new c(e,u.InvalidParameter,r);l===null&&(l=await q(()=>import("./knowledgeGraphService-pMLlB5D4.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));let f=null;const g=W(n[2],null);if(!(g instanceof D||g===null))throw new c(e,u.InvalidParameter,r);if(g){let o=[];f=v(g,!0,!1,e,o),o=o.filter((p=>!p.container[p.indexer].spatialReference.isWGS84)),o.length>0&&await ot(o)}const j=W(n[3],!1),x=new et({openCypherQuery:d,bindParameters:f,provenanceBehavior:j?"include":"exclude"});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(x.outputSpatialReference=e.spatialReference);const F=(await l.executeQueryStreaming(a,x)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await F.read();if(o)break;if(R(p))for(const h of p)y.push(m(h,e));else{const h=[];for(const N of p)h.push(m(p[N],e));y.push(h)}}}catch(o){throw o}return D.convertJsonToArcade(y,H(e),!1,!0)}))},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Et as registerFunctions};
