import{aU as Dt,s as Nt,L as Lt,V as Y,v as q,w as z,ga as Rt,x as Et,mF as mt,cJ as jt,c_ as Gt,bx as et,a_ as Ot,cN as qt,b1 as Wt,mG as Ut}from"./test-DMnSxVQs.js";let $t=class{constructor(e=null,n=null,l=null){this.minValue=e,this.maxValue=n,this.noDataValue=l}};const zt=9999999e31,Jt=2e-7,Xt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function lt(t){return Xt[t]??[-34028234663852886e22,34028234663852886e22]}const Ht={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function Kt(t){return Ht[t]}function Ue(t){return Kt(t.pixelType)*t.bandCount}function $e(t,e){return t==null||e==null?"s32":t<0?t>=-128&&e<128?"s8":t>=-32768&&e<32768?"s16":"s32":e<256?"u8":e<65536?"u16":"u32"}function Qt(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function Pe(t,e,n,l){let[r,s]=lt(n);const i=Qt(n);return i&&(r-=1e-5,s+=1e-5),i?n.startsWith("u")?Yt(t,e,l,[r,s]):Zt(t,e,l,[r,s]):te(t,e,l,[r,s])}function Te(t,e){for(let n=0;n<e.length;n++)e[n]&&isNaN(t[n])&&(e[n]=0,t[n]=0)}function Yt(t,e,n,l){const[r,s]=l;for(let i=0;i<e.length;i++)if(e[i]){const h=t[i];h<r||h>s?e[i]=0:n[i]=h+.5|0}}function Zt(t,e,n,l){const[r,s]=l;for(let i=0;i<e.length;i++)if(e[i]){const h=t[i];h<r||h>s?e[i]=0:n[i]=h+(h>0?.5:-.5)|0}}function te(t,e,n,l){const[r,s]=l;for(let i=0;i<e.length;i++)if(e[i]){const h=t[i];h<r||h>s?e[i]=0:n[i]=h}}function Ie(t,e,n){if(t.depthCount&&t.depthCount>1)return;const{pixels:l,statistics:r,pixelType:s}=t,i=l[0].length,h=t.bandMasks??[],o=t.mask??new Uint8Array(i).fill(255),a=s==="f32"||s==="f64",c=lt(s);let f=!1;for(let u=0;u<l.length;u++){const p=typeof e=="number"?e:e[u];if(p==null)continue;const g=r?.[u]?.minValue??c[0],m=r?.[u]?.maxValue??c[1];if(g>p+Number.EPSILON||m<p-Number.EPSILON)continue;const w=h[u]||o.slice(),y=l[u],M=n?.customFloatTolerance;if(a&&M!==0){let k=M;k||(k=Math.abs(p)>=zt?Jt*Math.abs(p):s==="f32"?2**-23:Number.EPSILON);for(let x=0;x<y.length;x++)w[x]&&Math.abs(y[x]-p)<k&&(y[x]=0,w[x]=0,o[x]=0,f=!0)}else for(let k=0;k<y.length;k++)w[k]&&y[k]===p&&(y[k]=0,w[k]=0,o[k]=0,f=!0);h[u]=w}if(f){const u=t.bandMasks||t.pixels.length>1?h:null;n?.matchAllNoData?t.mask=u&&u.length>1?d(u):o:(t.bandMasks=u,t.mask=o)}function d(u){if(u.length<2)return u[0];const p=u[0].length,g=new Uint8Array(p).fill(0);for(let m=0;m<u.length;m++){const w=u[m];for(let y=0;y<p;y++)w[y]&&(g[y]=255)}return g}f&&"updateStatistics"in t&&t.updateStatistics()}var H;let F=H=class extends Dt{static createEmptyBand(t,e){return new(H.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];const e=t[0].length,n=new Uint8Array(e).fill(255);for(let l=0;l<t.length;l++){const r=t[l];for(let s=0;s<e;s++)r[s]||(n[s]=0)}return n}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){return this.pixels?.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new Nt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new $t)}getAsRGBA(){const t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){const t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map((n=>ee(n,this.mask)));const t=this.mask;let e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;const[e,n]=lt(t),l=this.pixels,r=this.width*this.height,s=l.length;let i,h,o;const a=[];for(let c=0;c<s;c++){o=H.createEmptyBand(t,r),i=l[c];for(let f=0;f<r;f++)h=i[f],o[f]=h>n?n:h<e?e:h;a.push(o)}this.pixels=a,this.pixelType=t}extractBands(t){const{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;const l=e.length,r=t.some((f=>f>=e.length)),s=l===t.length&&!t.some(((f,d)=>f!==d));if(r||s)return this;const i=this.bandMasks?.length===l?t.map((f=>this.bandMasks[f])):void 0;let{mask:h,validPixelCount:o}=this;const{width:a,height:c}=this;return i?.length&&(h=H.combineBandMasks(i),o=h.filter((f=>!!f)).length),new H({pixelType:this.pixelType,width:a,height:c,mask:h,bandMasks:i,validPixelCount:o,maskIsAlpha:this.maskIsAlpha,pixels:t.map((f=>e[f])),statistics:n&&t.map((f=>n[f]))})}clone(){const t=new H({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let e;this.mask!=null&&(t.mask=new Uint8Array(this.mask)),this.bandMasks&&(t.bandMasks=this.bandMasks.map((l=>new Uint8Array(l))));const n=H.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];const l=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=l?this.pixels[e].slice():new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=Lt(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){const{mask:e,maskIsAlpha:n,premultiplyAlpha:l,pixels:r}=this;if(!t||!r?.length)return void Y.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let s,i,h,o;s=i=h=r[0],r.length>=3?(i=r[1],h=r[2]):r.length===2&&(i=r[1]);const a=new Uint32Array(t),c=this.width*this.height;if(s.length===c)if(e!=null&&e.length===c)if(n)for(o=0;o<c;o++){const f=e[o];if(f){const d=f/255;a[o]=l?f<<24|h[o]*d<<16|i[o]*d<<8|s[o]*d:f<<24|h[o]<<16|i[o]<<8|s[o]}}else for(o=0;o<c;o++)e[o]&&(a[o]=255<<24|h[o]<<16|i[o]<<8|s[o]);else for(o=0;o<c;o++)a[o]=255<<24|h[o]<<16|i[o]<<8|s[o];else Y.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){const{pixels:e,mask:n,statistics:l}=this;if(!t||!e?.length)return void Y.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const r=this.pixelType;let s=1,i=0,h=1;if(l&&l.length>0){for(const g of l)if(g.minValue!=null&&(i=Math.min(i,g.minValue)),g.maxValue!=null&&g.minValue!=null){const m=g.maxValue-g.minValue;h=Math.max(h,m)}s=255/h}else{let g=255;r==="s8"?(i=-128,g=127):r==="u16"?g=65535:r==="s16"?(i=-32768,g=32767):r==="u32"?g=4294967295:r==="s32"?(i=-2147483648,g=2147483647):r==="f32"?(i=-34e38,g=34e38):r==="f64"&&(i=-Number.MAX_VALUE,g=Number.MAX_VALUE),s=255/(g-i)}const o=new Uint32Array(t),a=this.width*this.height;let c,f,d,u,p;if(c=f=d=e[0],c.length!==a)return Y.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(f=e[1],e.length>=3&&(d=e[2]),n!=null&&n.length===a)for(u=0;u<a;u++)n[u]&&(o[u]=255<<24|(d[u]-i)*s<<16|(f[u]-i)*s<<8|(c[u]-i)*s);else for(u=0;u<a;u++)o[u]=255<<24|(d[u]-i)*s<<16|(f[u]-i)*s<<8|(c[u]-i)*s;else if(n!=null&&n.length===a)for(u=0;u<a;u++)p=(c[u]-i)*s,n[u]&&(o[u]=255<<24|p<<16|p<<8|p);else for(u=0;u<a;u++)p=(c[u]-i)*s,o[u]=255<<24|p<<16|p<<8|p}_fillFrom32Bit(t){const{pixels:e,mask:n}=this;if(!t||!e?.length)return Y.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let l,r,s,i;l=r=s=e[0],e.length>=3?(r=e[1],s=e[2]):e.length===2&&(r=e[1]);const h=this.width*this.height;if(l.length!==h)return Y.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let o=0;if(n!=null&&n.length===h)for(i=0;i<h;i++)t[o++]=l[i],t[o++]=r[i],t[o++]=s[i],t[o++]=1&n[i];else for(i=0;i<h;i++)t[o++]=l[i],t[o++]=r[i],t[o++]=s[i],t[o++]=1}};function ee(t,e){let n=1/0,l=-1/0;const r=t.length;let s,i=0;if(e!=null)for(s=0;s<r;s++)e[s]&&(i=t[s],n=i<n?i:n,l=i>l?i:l);else for(s=0;s<r;s++)i=t[s],n=i<n?i:n,l=i>l?i:l;return new $t(n,l)}q([z({json:{write:!0}})],F.prototype,"width",void 0),q([z({json:{write:!0}})],F.prototype,"height",void 0),q([z({json:{write:!0}})],F.prototype,"pixelType",void 0),q([Rt("pixelType")],F.prototype,"castPixelType",null),q([z({json:{write:!0}})],F.prototype,"validPixelCount",void 0),q([z({json:{write:!0}})],F.prototype,"mask",void 0),q([z({json:{write:!0}})],F.prototype,"maskIsAlpha",void 0),q([z({json:{write:!0}})],F.prototype,"pixels",void 0),q([z()],F.prototype,"premultiplyAlpha",void 0),q([z({json:{write:!0}})],F.prototype,"statistics",void 0),q([z({json:{write:!0}})],F.prototype,"depthCount",void 0),q([z({json:{write:!0}})],F.prototype,"noDataValues",void 0),q([z({json:{write:!0}})],F.prototype,"bandMasks",void 0),F=H=q([Et("esri.layers.support.PixelBlock")],F);var gt,xt;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(gt||(gt={})),(function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"})(xt||(xt={}));const wt=9;function N(t){return t!=null&&t.pixels?.length>0}function Be(t){if(!t?.length||t.some((c=>!N(c))))return null;if(t.length===1)return t[0]?.clone()??null;const e=t,{width:n,height:l,pixelType:r}=e[0];if(e.some((c=>c.width!==n||c.height!==l)))return null;const s=e.map((({mask:c})=>c)).filter((c=>c!=null));let i=null;s.length&&(i=new Uint8Array(n*l),i.set(s[0]),s.length>1&&Tt(s.slice(1),i));const h=[];e.forEach((({pixels:c})=>h.push(...c)));const o=e.map((({statistics:c})=>c)).filter((c=>c?.length)),a=[];return o.forEach((c=>a.push(...c))),new F({pixelType:r,width:n,height:l,mask:i,pixels:h,statistics:a.length?a:null})}function Se(t){if(!t)return;const e=t.colormap;if(!e||e.length===0)return;const n=e.sort(((o,a)=>o[0]-a[0])),l=n[0][0]<0?n[0][0]:0,r=Math.max(256,n[n.length-1][0]-l+1),s=new Uint8Array(4*r),i=[],h=n[0].length===5;if(r>65536)return n.forEach((o=>{i[o[0]-l]=h?o.slice(1):o.slice(1).concat([255])})),{indexed2DColormap:i,offset:l,alphaSpecified:h};if(t.fillUnspecified){let o=n[0];for(let a=o[0]-l,c=0;a<r;a++)s[4*a]=o[1],s[4*a+1]=o[2],s[4*a+2]=o[3],s[4*a+3]=h?o[4]:255,a===o[0]-l&&(o=c===n.length-1?o:n[++c])}else for(let o=0;o<n.length;o++){const a=n[o],c=4*(a[0]-l);s[c]=a[1],s[c+1]=a[2],s[c+2]=a[3],s[c+3]=h?a[4]:255}return{indexedColormap:s,offset:l,alphaSpecified:h}}function Fe(t,e){if(!N(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;const n=t.clone(),l=n.pixels;let r=n.mask;const s=n.width*n.height;if(l.length!==1)return t;const{indexedColormap:i,indexed2DColormap:h,offset:o,alphaSpecified:a}=e,c=l[0],f=new Uint8Array(c.length),d=new Uint8Array(c.length),u=new Uint8Array(c.length);let p,g=0;if(i){const m=i.length-1;if(r!=null)for(let w=0;w<s;w++)r[w]&&(g=4*(c[w]-o),g<o||g>m?r[w]=0:(f[w]=i[g],d[w]=i[g+1],u[w]=i[g+2],r[w]=i[g+3]));else{r=new Uint8Array(s);for(let w=0;w<s;w++)g=4*(c[w]-o),g<o||g>m?r[w]=0:(f[w]=i[g],d[w]=i[g+1],u[w]=i[g+2],r[w]=i[g+3]);n.mask=r}}else if(h)if(r!=null)for(let m=0;m<s;m++)r[m]&&(p=h[c[m]],f[m]=p[0],d[m]=p[1],u[m]=p[2],r[m]=p[3]);else{r=new Uint8Array(s);for(let m=0;m<s;m++)p=h[c[m]],f[m]=p[0],d[m]=p[1],u[m]=p[2],r[m]=p[3];n.mask=r}return n.pixels=[f,d,u],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=a,n}function Ce(t,e){if(!N(t))return null;const{pixels:n,mask:l}=t,r=n.length;let s=e.lut;const{offset:i}=e;s&&s[0].length===1&&(s=n.map((()=>s)));const h=[],o=e.outputPixelType||"u8";for(let c=0;c<r;c++){const f=Pt(n[c],l,s[c],i||0,o);h.push(f)}const a=new F({width:t.width,height:t.height,pixels:h,mask:l,pixelType:o});return a.updateStatistics(),a}function Pt(t,e,n,l,r){const s=t.length,i=F.createEmptyBand(r,s);if(e)for(let h=0;h<s;h++)e[h]&&(i[h]=n[t[h]-l]);else for(let h=0;h<s;h++)i[h]=n[t[h]-l];return i}function Ve(t,e){if(!N(t))return null;const n=t.clone(),{pixels:l}=n,r=n.width*n.height,s=e.length,i=Math.floor(s/2),h=e[Math.floor(i)],o=l[0],a=new Uint8Array(r),c=new Uint8Array(r),f=new Uint8Array(r);let d=n.mask;const u=e[0].mappedColor.length===4;d||(d=new Uint8Array(r),d.fill(u?255:1),n.mask=d);for(let p=0;p<r;p++)if(d[p]){const g=o[p];let m=!1,w=i,y=h,M=0,k=s-1;for(;k-M>1;){if(g===y.value){m=!0;break}g>y.value?M=w:k=w,w=Math.floor((M+k)/2),y=e[Math.floor(w)]}m||(g===e[M].value?(y=e[M],m=!0):g===e[k].value?(y=e[k],m=!0):g<e[M].value?m=!1:g>e[M].value&&(g<e[k].value?(y=e[M],m=!0):k===s-1?m=!1:(y=e[k],m=!0))),m?(a[p]=y.mappedColor[0],c[p]=y.mappedColor[1],f[p]=y.mappedColor[2],d[p]=y.mappedColor[3]):a[p]=c[p]=f[p]=d[p]=0}return n.pixels=[a,c,f],n.mask=d,n.pixelType="u8",n.maskIsAlpha=u,n}function _e(t,e,n=!1){const r=new Float32Array(3*wt),s=e.length;for(let i=0;i<wt;i++)r[3*i]=t[2*i]??mt-1,r[3*i+1]=t[2*i+1]??mt,r[3*i+2]=e[i]??0,i<s&&(i>0&&(r[3*i]-=1e-5),t[2*i+1]!==t[2*i]&&(i<s-1||!n)&&(r[3*i+1]-=1e-5));return r}function De(t,e){if(!N(t))return null;const{width:n,height:l}=t,{inputRanges:r,outputValues:s,outputPixelType:i,noDataRanges:h,allowUnmatched:o,replacementValue:a,isLastInputRangeInclusive:c}=e,f=t.pixels[0],d=F.createEmptyBand(i,f.length),u=t.mask,p=new Uint8Array(n*l);u?p.set(u):p.fill(255);const g=t.pixelType.startsWith("f")?1e-6:0,m=r.map((x=>x-g));m[0]=r[0],m[m.length-1]=r[r.length-1]+(c?1e-6:0);const w=r.length/2,[y,M]=lt(i);for(let x=0;x<l;x++)for(let A=0;A<n;A++){const U=x*n+A;if(p[U]){const b=f[U];let P=!1;for(let $=w-1;$>=0;$--)if(b===r[2*$]||b>m[2*$]&&b<m[2*$+1]){d[U]=s[$],P=!0;break}P||(o?d[U]=b>M?M:b<y?y:a??b:p[U]=0)}}const k=h?.length;if(k)for(let x=0;x<l;x++)for(let A=0;A<n;A++){const U=x*n+A;if(!u||u[U]){const b=f[U];for(let P=0;P<k;P+=2)if(b>=h[P]&&b<=h[P+1]){d[U]=0,p[U]=0;break}}}return new F({width:n,height:l,pixelType:i,pixels:[d],mask:p})}function yt(t,e,n,l){const r=n!=null&&n.length>=2?new Set(n):null,s=n?.length===1?n[0]:null,i=!!e?.length;for(let h=0;h<t.length;h++)if(l[h]){const o=t[h];if(i){let a=!1;for(let c=0;c<e.length;c+=2)if(o>=e[c]&&o<=e[c+1]){a=!0;break}a||(l[h]=0)}l[h]&&(o===s||r?.has(o))&&(l[h]=0)}}function kt(t,e){const n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let r=!1;for(let s=0;s<t.length;s++)if(t[s][l]){r=!0;break}r||(e[l]=0)}}function Tt(t,e){const n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let r=!1;for(let s=0;s<t.length;s++)if(t[s][l]===0){r=!0;break}r&&(e[l]=0)}}function Ne(t,e){if(!N(t))return null;const{width:n,height:l,pixels:r}=t,s=n*l,i=new Uint8Array(s);t.mask?i.set(t.mask):i.fill(255);const h=r.length,{includedRanges:o,noDataValues:a,outputPixelType:c,matchAll:f,lookups:d}=e;if(d){const u=[];for(let p=0;p<h;p++){const g=d[p],m=Pt(r[p],i,g.lut,g.offset||0,"u8");u.push(m)}u.length===1?i.set(u[0]):f?kt(u,i):Tt(u,i)}else if(f){const u=[];for(let p=0;p<h;p++){const g=new Uint8Array(s);g.set(i),yt(r[p],o?.slice(2*p,2*p+2),a?.[p],g),u.push(g)}u.length===1?i.set(u[0]):kt(u,i)}else for(let u=0;u<h;u++)yt(r[u],o?.slice(2*u,2*u+2),a?.[u],i);return new F({width:n,height:l,pixelType:c,pixels:r,mask:i})}function Le(t){const{srcPixelType:e,inputRanges:n,outputValues:l,allowUnmatched:r,noDataRanges:s,isLastInputRangeInclusive:i,outputPixelType:h}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;const o=e.includes("16")?65536:256,a=e.includes("s")?-o/2:0,c=F.createEmptyBand(h,o),f=new Uint8Array(o);r&&f.fill(255);const[d,u]=lt(h);if(n?.length&&l?.length){const g=n.map((m=>m-1e-6));g[0]=n[0],i&&(g[g.length-1]=n[n.length-1]);for(let m=0;m<g.length;m++){const w=l[m]>u?u:l[m]<d?d:l[m],y=Math.ceil(g[2*m]-a),M=n[2*m+1]===n[2*m]?y:Math.floor(g[2*m+1]-a);for(let k=y;k<=M;k++)c[k]=w,f[k]=255}}if(s?.length)for(let p=0;p<s.length;p++){const g=Math.ceil(s[2*p]-a),m=Math.floor(s[2*p+1]-a);for(let w=g;w<=m;w++)f[w]=0}return{lut:c,offset:a,mask:f}}function Re(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const l=t.includes("16")?65536:256,r=t.includes("s")?-l/2:0,s=new Uint8Array(l);if(e)for(let i=0;i<e.length;i++){const h=Math.ceil(e[2*i]-r),o=Math.floor(e[2*i+1]-r);for(let a=h;a<=o;a++)s[a]=255}else s.fill(255);if(n)for(let i=0;i<n.length;i++)s[n[i]-r]=0;return{lut:s,offset:r}}function ne(t,e,n,l,r,s,i,h){return{xmin:r<=n*t?0:r<n*t+t?r-n*t:t,ymin:s<=l*e?0:s<l*e+e?s-l*e:e,xmax:r+i<=n*t?0:r+i<n*t+t?r+i-n*t:t,ymax:s+h<=l*e?0:s+h<l*e+e?s+h-l*e:e}}function Ee(t,e){if(!t||t.length===0)return null;const n=t.find((p=>p.pixelBlock));if(n?.pixelBlock==null)return null;const l=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,r=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,s=.01*Math.min(l,r),i=t.sort(((p,g)=>Math.abs(p.extent.ymax-g.extent.ymax)>s?g.extent.ymax-p.extent.ymax:Math.abs(p.extent.xmin-g.extent.xmin)>s?p.extent.xmin-g.extent.xmin:0)),h=Math.min.apply(null,i.map((p=>p.extent.xmin))),o=Math.min.apply(null,i.map((p=>p.extent.ymin))),a=Math.max.apply(null,i.map((p=>p.extent.xmax))),c=Math.max.apply(null,i.map((p=>p.extent.ymax))),f={x:Math.round((e.xmin-h)/l),y:Math.round((c-e.ymax)/r)},d={width:Math.round((a-h)/l),height:Math.round((c-o)/r)},u={width:Math.round((e.xmax-e.xmin)/l),height:Math.round((e.ymax-e.ymin)/r)};return Math.round(d.width/n.pixelBlock.width)*Math.round(d.height/n.pixelBlock.height)!==i.length||f.x<0||f.y<0||d.width<u.width||d.height<u.height?null:{extent:e,pixelBlock:ie(i.map((p=>p.pixelBlock)),d,{clipOffset:f,clipSize:u})}}function ct(t,e,n,l,r,s){const{width:i,height:h}=n.block,{x:o,y:a}=n.offset,{width:c,height:f}=n.mosaic,d=ne(i,h,l,r,o,a,c,f);let u=0,p=0;if(s){const g=s.hasGCSSShiftTransform?360:s.halfWorldWidth??0,m=i*s.resolutionX,w=s.startX+l*m;w<g&&w+m>g?p=s.rightPadding:w>=g&&(u=s.leftMargin-s.rightPadding,p=0)}if(d.xmax-=p,typeof e!="number")for(let g=d.ymin;g<d.ymax;g++){const m=(r*h+g-a)*c+(l*i-o)+u,w=g*i;for(let y=d.xmin;y<d.xmax;y++)t[m+y]=e[w+y]}else for(let g=d.ymin;g<d.ymax;g++){const m=(r*h+g-a)*c+(l*i-o)+u;for(let w=d.xmin;w<d.xmax;w++)t[m+w]=e}}function ie(t,e,n={}){const{clipOffset:l,clipSize:r,alignmentInfo:s,blockWidths:i}=n;if(i)return se(t,e,{blockWidths:i});const h=t.find(($=>N($)));if(h==null)return null;const o=r?r.width:e.width,a=r?r.height:e.height,c=h.width,f=h.height,d=e.width/c,u=e.height/f,p={offset:l||{x:0,y:0},mosaic:r||e,block:{width:c,height:f}},g=h.pixelType,m=F.getPixelArrayConstructor(g),w=h.pixels.length,y=[];let M,k;for(let $=0;$<w;$++){k=new m(o*a);for(let T=0;T<u;T++)for(let v=0;v<d;v++){const B=t[T*d+v];N(B)&&(M=B.pixels[$],ct(k,M,p,v,T,s))}y.push(k)}const x=t.some(($=>$==null||$.mask!=null&&$.mask.length>0)),A=t.some(($=>$?.bandMasks&&$.bandMasks.length>1)),U=x?new Uint8Array(o*a):void 0,b=A?[]:void 0;if(U){for(let $=0;$<u;$++)for(let T=0;T<d;T++){const v=t[$*d+T],B=v!=null?v.mask:null;ct(U,B??(v?255:0),p,T,$,s)}if(b)for(let $=0;$<w;$++){const T=new Uint8Array(o*a);for(let v=0;v<u;v++)for(let B=0;B<d;B++){const _=t[v*d+B],S=_?.bandMasks?.[$]??_?.mask;ct(T,S??(_?255:0),p,B,v,s)}b.push(T)}}const P=new F({width:o,height:a,pixels:y,pixelType:g,bandMasks:b,mask:U});return P.updateStatistics(),P}function se(t,e,n){const l=t.find((m=>m!=null));if(l==null)return null;const r=t.some((m=>m==null||!!m.mask)),{width:s,height:i}=e,h=r?new Uint8Array(s*i):null,{blockWidths:o}=n,a=[],c=l.getPlaneCount(),f=F.getPixelArrayConstructor(l.pixelType);if(r)for(let m=0,w=0;m<t.length;w+=o[m],m++){const y=t[m];if(!N(y))continue;const M=y.mask;for(let k=0;k<i;k++)for(let x=0;x<o[m];x++)h[k*s+x+w]=M==null?255:M[k*y.width+x]}const d=t.some((m=>m?.bandMasks&&m.bandMasks.length>1)),u=d?[]:void 0,p=s*i;for(let m=0;m<c;m++){const w=new f(p),y=d?new Uint8Array(p):void 0;for(let M=0,k=0;M<t.length;k+=o[M],M++){const x=t[M];if(!N(x))continue;const A=x.pixels[m];if(A!=null){for(let U=0;U<i;U++)for(let b=0;b<o[M];b++)w[U*s+b+k]=A[U*x.width+b];if(y){const U=x.bandMasks?.[m]??x.mask;for(let b=0;b<i;b++)for(let P=0;P<o[M];P++)y[b*s+P+k]=U?U[b*x.width+P]:255}}}a.push(w),u&&y&&u.push(y)}const g=new F({width:s,height:i,mask:h,bandMasks:u,pixels:a,pixelType:l.pixelType});return g.updateStatistics(),g}function je(t,e,n){if(!N(t))return null;const{width:l,height:r}=t,s=e.x,i=e.y,h=n.width+s,o=n.height+i;if(s<0||i<0||h>l||o>r||s===0&&i===0&&h===l&&o===r)return t;t.mask||(t.mask=new Uint8Array(l*r));const a=t.mask;for(let c=0;c<r;c++){const f=c*l;for(let d=0;d<l;d++)a[f+d]=c<i||c>=o||d<s||d>=h?0:1}return t.updateStatistics(),t}function le(t){if(!N(t))return null;const e=t.clone(),{width:n,height:l,pixels:r}=t,s=r[0],i=e.pixels[0],h=t.mask;for(let o=2;o<l-1;o++){const a=new Map;for(let f=o-2;f<o+2;f++)for(let d=0;d<4;d++){const u=f*n+d;st(a,s[u],h?h[u]:1)}i[o*n]=Mt(a),i[o*n+1]=i[o*n+2]=i[o*n];let c=3;for(;c<n-1;c++){let f=(o-2)*n+c+1;st(a,s[f],h?h[f]:1),f=(o-1)*n+c+1,st(a,s[f],h?h[f]:1),f=o*n+c+1,st(a,s[f],h?h[f]:1),f=(o+1)*n+c+1,st(a,s[f],h?h[f]:1),f=(o-2)*n+c-3,rt(a,s[f],h?h[f]:1),f=(o-1)*n+c-3,rt(a,s[f],h?h[f]:1),f=o*n+c-3,rt(a,s[f],h?h[f]:1),f=(o+1)*n+c-3,rt(a,s[f],h?h[f]:1),i[o*n+c]=Mt(a)}i[o*n+c+1]=i[o*n+c]}for(let o=0;o<n;o++)i[o]=i[n+o]=i[2*n+o],i[(l-1)*n+o]=i[(l-2)*n+o];return e.updateStatistics(),e}function Mt(t){if(t.size===0)return 0;let e=0,n=-1,l=0;const r=t.keys();let s=r.next();for(;!s.done;)l=t.get(s.value),l>e&&(n=s.value,e=l),s=r.next();return n}function rt(t,e,n){if(n===0)return;const l=t.get(e);l===1?t.delete(e):t.set(e,l-1)}function st(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function It(t,e,n){let{x:l,y:r}=e;const{width:s,height:i}=n;if(l===0&&r===0&&i===t.height&&s===t.width)return t;const{width:h,height:o}=t,a=Math.max(0,r),c=Math.max(0,l),f=Math.min(l+s,h),d=Math.min(r+i,o);if(f<0||d<0||!N(t))return null;l=Math.max(0,-l),r=Math.max(0,-r);const{pixels:u}=t,p=s*i,g=u.length,m=[];for(let k=0;k<g;k++){const x=u[k],A=F.createEmptyBand(t.pixelType,p);for(let U=a;U<d;U++){const b=U*h;let P=(U+r-a)*s+l;for(let $=c;$<f;$++)A[P++]=x[b+$]}m.push(A)}const w=new Uint8Array(p),y=t.mask;for(let k=a;k<d;k++){const x=k*h;let A=(k+r-a)*s+l;for(let U=c;U<f;U++)w[A++]=y?y[x+U]:1}const M=new F({width:n.width,height:n.height,pixelType:t.pixelType,pixels:m,mask:w});return M.updateStatistics(),M}function Bt(t,e=!0){if(!N(t))return null;const{pixels:n,width:l,height:r,mask:s,pixelType:i}=t,h=[],o=Math.round(l/2),a=Math.round(r/2),c=r-1,f=l-1;for(let u=0;u<n.length;u++){const p=n[u],g=F.createEmptyBand(i,o*a);let m=0;for(let w=0;w<r;w+=2)for(let y=0;y<l;y+=2){const M=p[w*l+y];if(e){const k=y===f?M:p[w*l+y+1],x=w===c?M:p[w*l+y+l],A=y===f?x:w===c?k:p[w*l+y+l+1];g[m++]=(M+k+x+A)/4}else g[m++]=M}h.push(g)}let d=null;if(s!=null){d=new Uint8Array(o*a);let u=0;for(let p=0;p<r;p+=2)for(let g=0;g<l;g+=2){const m=s[p*l+g];if(e){const w=g===f?m:s[p*l+g+1],y=p===c?m:s[p*l+g+l],M=g===f?y:p===c?w:s[p*l+g+l+1];d[u++]=m*w*y*M?1:0}else d[u++]=m}}return new F({width:o,height:a,pixelType:i,pixels:h,mask:d})}function Ge(t,e,n=0,l=!0){if(!N(t))return null;const{width:r,height:s}=e;let{width:i,height:h}=t;const o=new Map,a={x:0,y:0},c=1+n;let f=t;for(let d=0;d<c;d++){const u=Math.ceil(i/r),p=Math.ceil(h/s);for(let g=0;g<p;g++){a.y=g*s;for(let m=0;m<u;m++){a.x=m*r;const w=It(f,a,e);o.set(`${d}/${g}/${m}`,w)}}d<c-1&&(f=Bt(f,l)),i=Math.round(i/2),h=Math.round(h/2)}return o}function Oe(t){const{pixelBlock:e,tileSize:n,level:l,row:r,col:s,useBilinear:i}=t;if(!N(e))return null;const{width:h,height:o}=n,a=2**l,c=a*h,f=a*o;let d=It(e,{y:r*f,x:s*c},{width:c,height:f});if(!d)return null;for(let u=l;u>0;u--)d=Bt(d,i);return d}function St(t,e,n,l,r=0){const{width:s,height:i}=t,{width:h,height:o}=e,a=l.cols,c=l.rows,f=Math.ceil(h/a-.1/a),d=Math.ceil(o/c-.1/c);let u,p,g,m,w,y,M;const k=f*a,x=k*d*c,A=new Float32Array(x),U=new Float32Array(x),b=new Uint32Array(x),P=new Uint32Array(x);let $,T,v=0;for(let B=0;B<d;B++)for(let _=0;_<f;_++){u=12*(B*f+_),p=n[u],g=n[u+1],m=n[u+2],w=n[u+3],y=n[u+4],M=n[u+5];for(let S=0;S<c;S++){v=(B*c+S)*k+_*a,T=(S+.5)/c;for(let I=0;I<S;I++)$=(I+.5)/a,A[v+I]=(p*$+g*T+m)*s+r,U[v+I]=(w*$+y*T+M)*i+r,b[v+I]=Math.floor(A[v+I]),P[v+I]=Math.floor(U[v+I])}u+=6,p=n[u],g=n[u+1],m=n[u+2],w=n[u+3],y=n[u+4],M=n[u+5];for(let S=0;S<c;S++){v=(B*c+S)*k+_*a,T=(S+.5)/c;for(let I=S;I<a;I++)$=(I+.5)/a,A[v+I]=(p*$+g*T+m)*s+r,U[v+I]=(w*$+y*T+M)*i+r,b[v+I]=Math.floor(A[v+I]),P[v+I]=Math.floor(U[v+I])}}return{offsets_x:A,offsets_y:U,offsets_xi:b,offsets_yi:P,gridWidth:k}}function qe(t,e){const{coefficients:n,spacing:l}=e,{offsets_x:r,offsets_y:s,gridWidth:i}=St(t,t,n,{rows:l[0],cols:l[1]}),{width:h,height:o}=t,a=new Float32Array(h*o),c=180/Math.PI;for(let f=0;f<o;f++)for(let d=0;d<h;d++){const u=f*i+d,p=f===0?u:u-i,g=f===o-1?u:u+i,m=r[p]-r[g],w=s[g]-s[p];if(isNaN(m)||isNaN(w))a[f*h+d]=90;else{let y=Math.atan2(w,m)*c;y=(360+y)%360,a[f*h+d]=y}}return a}function We(t,e,n,l,r="nearest"){if(!N(t))return null;r==="majority"&&(t=le(t));const{pixels:s,mask:i,bandMasks:h,pixelType:o}=t,a=t.width,c=t.height,f=F.getPixelArrayConstructor(o),d=s.length,{width:u,height:p}=e;let g=!1;for(let v=0;v<n.length;v+=3)n[v]===-1&&n[v+1]===-1&&n[v+2]===-1&&(g=!0);const{offsets_x:m,offsets_y:w,offsets_xi:y,offsets_yi:M,gridWidth:k}=St({width:a,height:c},e,n,l,r==="majority"?.5:0);let x;const A=(v,B,_,S)=>{const I=v instanceof Float32Array||v instanceof Float64Array?0:.5;for(let C=0;C<p;C++){x=C*k;for(let V=0;V<u;V++){if(m[x]<0||w[x]<0)v[C*u+V]=0;else if(S)v[C*u+V]=B[y[x]+M[x]*a];else{const E=Math.floor(m[x]),O=Math.floor(w[x]),L=Math.ceil(m[x]),G=Math.ceil(w[x]),W=m[x]-E,X=w[x]-O;if(!_||_[E+O*a]&&_[L+O*a]&&_[E+G*a]&&_[L+G*a]){const tt=(1-W)*B[E+O*a]+W*B[L+O*a],K=(1-W)*B[E+G*a]+W*B[L+G*a];v[C*u+V]=(1-X)*tt+X*K+I}else v[C*u+V]=B[y[x]+M[x]*a]}x++}}},U=[];let b;const P=h?.length===d,$=[];for(let v=0;v<d;v++){if(P){const B=new Uint8Array(u*p);A(B,h[v],h[v],!0),$.push(B)}b=new f(u*p),A(b,s[v],P?h[v]:i,r==="nearest"||r==="majority"),U.push(b)}const T=new F({width:u,height:p,pixelType:o,pixels:U,bandMasks:P?$:void 0});if(i!=null)T.mask=new Uint8Array(u*p),A(T.mask,i,i,!0);else if(g){T.mask=new Uint8Array(u*p);for(let v=0;v<u*p;v++)T.mask[v]=m[v]<0||w[v]<0?0:1}return T.updateStatistics(),T}const Z=new Map;Z.set("meter-per-second",1),Z.set("kilometer-per-hour",.277778),Z.set("knots",.514444),Z.set("feet-per-second",.3048),Z.set("mile-per-hour",.44704);const ft=180/Math.PI,pt=5,at=new jt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function dt(t,e){return Z.get(t)/Z.get(e)||1}function Ft(t){return(450-t)%360}function Ct(t,e="geographic"){const[n,l]=t,r=Math.sqrt(n*n+l*l);let s=Math.atan2(l,n)*ft;return s=(360+s)%360,e==="geographic"&&(s=Ft(s)),[r,s]}function re(t,e="geographic"){let n=t[1];e==="geographic"&&(n=Ft(n)),n%=360;const l=t[0];return[l*Math.cos(n/ft),l*Math.sin(n/ft)]}function ze(t,e,n,l="geographic"){if(!N(t)||n==null)return t;const r=e==="vector-magdir"?t.clone():At(t,e),s=r.pixels[1];for(let i=0;i<s.length;i++)s[i]=l==="geographic"?(s[i]+n[i]+270)%360:(s[i]+360-n[i])%360;return e==="vector-magdir"?r:At(r,"vector-magdir")}function At(t,e,n="geographic",l=1){if(!N(t))return t;const{pixels:r,width:s,height:i}=t,h=s*i,o=r[0],a=r[1],c=t.pixelType.startsWith("f")?t.pixelType:"f32",f=F.createEmptyBand(c,h),d=F.createEmptyBand(c,h);let u=0;for(let g=0;g<i;g++)for(let m=0;m<s;m++)e==="vector-uv"?([f[u],d[u]]=Ct([o[u],a[u]],n),f[u]*=l):([f[u],d[u]]=re([o[u],a[u]],n),f[u]*=l,d[u]*=l),u++;const p=new F({pixelType:c,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[f,d]});return p.updateStatistics(),p}function Je(t,e,n=1){if(n===1||!N(t))return t;const l=t.clone(),{pixels:r,width:s,height:i}=l,h=r[0];r[1];let o=0;for(let a=0;a<i;a++)for(let c=0;c<s;c++)h[o]*=n,o++;return l.updateStatistics(),l}function Xe(t,e,n,l,r){if(r==null||!r.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/l),height:Math.round(n/l),resolution:t.width/e};const s=r.xmin,i=r.ymax,h=(t.xmax-t.xmin)/e*l,o=(t.ymax-t.ymin)/n*l,a=(h+o)/2;return t.xmin=s+Math.floor((t.xmin-s)/h)*h,t.xmax=s+Math.ceil((t.xmax-s)/h)*h,t.ymin=i+Math.floor((t.ymin-i)/o)*o,t.ymax=i+Math.ceil((t.ymax-i)/o)*o,{extent:t,width:Math.round(t.width/h),height:Math.round(t.height/o),resolution:a}}const oe=Vt(0,0,0);function Vt(t=0,e=0,n=Math.PI,l=!0){l&&(n=(2*Math.PI-n)%(2*Math.PI));const r=l?-1:1,s=13*r,i=-7*r,h=-2*r,o=-16*r,a=21.75,[c,f]=j(0,e+s,n,a),[d,u]=j(t-5.5,e+i,n,a),[p,g]=j(t+5.5,e+i,n,a),[m,w]=j(t-1.5,e+h,n,a),[y,M]=j(t+1.5,e+h,n,a),[k,x]=j(t-1.5,e+o,n,a),[A,U]=j(t+1.5,e+o,n,a);return[c,f,d,u,m,w,y,M,p,g,k,x,A,U]}function ae(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const l=10,r=n?-1:1,s=5*r,i=20*r,h=25*r,o=45,a=0,c=0,f=2,d=0,u=f*r,p=n?1:-1,g=l/2*p;let[m,w]=[a+g,c-i],[y,M]=[m+f*p,w],[k,x]=[y-d*p,M+u],[A,U]=[a-g,c-h],[b,P]=[A+d*p,U-u],$=Math.ceil(t/pt),T=Math.floor($/10);$-=8*T;const v=[],B=[];for(let W=0;W<$/2;W++,T--){T<=0&&$%2==1&&W===($-1)/2&&(A=a,b=A+d*p,U=(U+w)/2,P=U-u);const[X,tt]=j(A,U,e,o);if(T>0){const[K,nt]=j(y,U,e,o),[it,D]=j(m,w,e,o);v.push(K),v.push(nt),v.push(X),v.push(tt),v.push(it),v.push(D)}else{const[K,nt]=j(y,M,e,o),[it,D]=j(k,x,e,o),[R,ht]=j(b,P,e,o);B.push(X),B.push(tt),B.push(R),B.push(ht),B.push(it),B.push(D),B.push(K),B.push(nt)}U+=s,w+=s,M+=s,x+=s,P+=s}const[_,S]=j(a+g,c+i,e,o),I=(l/2+f)*p,[C,V]=j(a+I,c+i,e,o),[E,O]=j(a+g,c-h,e,o),[L,G]=j(a+I,c-h,e,o);return{pennants:v,barbs:B,shaft:[_,S,C,V,E,O,L,G]}}function j(t,e,n,l=1){const r=Math.sqrt(t*t+e*e)/l,s=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[r,(2*Math.PI+s-n)%(2*Math.PI)]}const ot=[0,1,3,6,10,16,21,27,33,40,47,55,63],he=[0,.5,1,1.5,2],ce=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function Q(t,e,n,l){const r=dt(l||"knots",n);let s;for(s=1;s<e.length;s++)if(s===e.length-1){if(t<e[s]*r)break}else if(t<=e[s]*r)break;return Math.min(s-1,e.length-2)}function ue(t,e,n,l,r){let s=0;switch(e){case"beaufort_kn":s=Q(t,ot,"knots",n);break;case"beaufort_km":s=Q(t,ot,"kilometer-per-hour",n);break;case"beaufort_ft":s=Q(t,ot,"feet-per-second",n);break;case"beaufort_m":s=Q(t,ot,"meter-per-second",n);break;case"classified_arrow":s=Q(t,r??[],l,n);break;case"ocean_current_m":s=Q(t,he,"meter-per-second",n);break;case"ocean_current_kn":s=Q(t,ce,"knots",n)}return s}function fe(t,e){const{style:n,inputUnit:l,outputUnit:r,breakValues:s}=e,i=at.fromJSON(l),h=at.fromJSON(r),o=42,a=15;let c=0,f=0;const{width:d,height:u,mask:p}=t,g=t.pixels[0],m=t.pixels[1],w=p!=null?p.filter((x=>x>0)).length:d*u,y=new Float32Array(w*o),M=new Uint32Array(a*w),k=e.invertDirection?Vt(0,0,0,!1):oe;for(let x=0;x<u;x++)for(let A=0;A<d;A++){const U=x*d+A;if(!p||p[x*d+A]){const b=(m[U]+360)%360/180*Math.PI,P=ue(g[U],n,i,h,s);for(let T=0;T<k.length;T+=2)y[c++]=(A+.5)/d,y[c++]=(x+.5)/u,y[c++]=k[T],y[c++]=k[T+1]+b,y[c++]=P,y[c++]=g[U];const $=7*(c/o-1);M[f++]=$,M[f++]=$+1,M[f++]=$+2,M[f++]=$+0,M[f++]=$+4,M[f++]=$+3,M[f++]=$+0,M[f++]=$+2,M[f++]=$+3,M[f++]=$+2,M[f++]=$+5,M[f++]=$+3,M[f++]=$+5,M[f++]=$+6,M[f++]=$+3}}return{vertexData:y,indexData:M}}const ut=[];function pe(t,e){if(ut.length===0)for(let u=0;u<30;u++)ut.push(ae(5*u,0,!e.invertDirection));const n=dt(at.fromJSON(e.inputUnit),"knots"),{width:l,height:r,mask:s}=t,i=t.pixels[0],h=t.pixels[1],o=6,a=[],c=[];let f=0,d=0;for(let u=0;u<r;u++)for(let p=0;p<l;p++){const g=u*l+p,m=i[g]*n;if((!s||s[u*l+p])&&m>=pt){const w=(h[g]+360)%360/180*Math.PI,{pennants:y,barbs:M,shaft:k}=ut[Math.min(Math.floor(m/5),29)];if(y.length+M.length===0)continue;let x=a.length/o;const A=(p+.5)/l,U=(u+.5)/r;for(let b=0;b<y.length;b+=2)a[f++]=A,a[f++]=U,a[f++]=y[b],a[f++]=y[b+1]+w,a[f++]=0,a[f++]=m;for(let b=0;b<M.length;b+=2)a[f++]=A,a[f++]=U,a[f++]=M[b],a[f++]=M[b+1]+w,a[f++]=0,a[f++]=m;for(let b=0;b<k.length;b+=2)a[f++]=A,a[f++]=U,a[f++]=k[b],a[f++]=k[b+1]+w,a[f++]=0,a[f++]=m;for(let b=0;b<y.length/6;b++)c[d++]=x,c[d++]=x+1,c[d++]=x+2,x+=3;for(let b=0;b<M.length/8;b++)c[d++]=x,c[d++]=x+1,c[d++]=x+2,c[d++]=x+1,c[d++]=x+2,c[d++]=x+3,x+=4;c[d++]=x+0,c[d++]=x+1,c[d++]=x+2,c[d++]=x+1,c[d++]=x+3,c[d++]=x+2,x+=4}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(c)}}function de(t,e){let l=0,r=0;const{width:s,height:i,mask:h}=t,o=t.pixels[0],a=[],c=[],f=dt(at.fromJSON(e.inputUnit),"knots"),d=e.style==="wind_speed"?pt:Number.MAX_VALUE;for(let u=0;u<i;u++)for(let p=0;p<s;p++){const g=o[u*s+p]*f;if((!h||h[u*s+p])&&g<d){for(let w=0;w<4;w++)a[l++]=(p+.5)/s,a[l++]=(u+.5)/i,a[l++]=w<2?-.5:.5,a[l++]=w%2==0?-.5:.5,a[l++]=0,a[l++]=g;const m=4*(l/24-1);c[r++]=m,c[r++]=m+1,c[r++]=m+2,c[r++]=m+1,c[r++]=m+2,c[r++]=m+3}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(c)}}function He(t,e){return e.style==="simple_scalar"?de(t,e):e.style==="wind_speed"?pe(t,e):fe(t,e)}function Ke(t,e,n,l=[0,0],r=.5){const{width:s,height:i,mask:h}=t,[o,a]=t.pixels,[c,f]=l,d=Math.round((s-c)/n),u=Math.round((i-f)/n),p=d*u,g=new Float32Array(p),m=new Float32Array(p),w=new Uint8Array(p);for(let M=0;M<u;M++)for(let k=0;k<d;k++){let x=0;const A=M*d+k,U=Math.max(0,M*n+f),b=Math.max(0,k*n+c),P=Math.min(i,U+n),$=Math.min(s,b+n);for(let T=U;T<P;T++)for(let v=b;v<$;v++){const B=T*s+v;if(!h||h[B]){x++;const _=[o[B],a[B]],[S,I]=_;g[A]+=S,m[A]+=I}}if(x>=(P-U)*($-b)*(1-r)){w[A]=1;const[T,v]=Ct([g[A]/x,m[A]/x]);g[A]=T,m[A]=v}else w[A]=0,g[A]=0,m[A]=0}const y=new F({width:d,height:u,pixels:[g,m],mask:w});return y.updateStatistics(),y}const J=()=>Y.getLogger("esri.views.2d.engine.flow.dataUtils"),me=10;async function Qe(t,e,n,l){const r=performance.now(),s=ge(e,n),i=performance.now(),h=we(e,s,n.width,n.height),o=performance.now(),a=ke(h),c=performance.now(),f=t==="Streamlines"?Me(a,me):Ae(a),d=performance.now();return et("esri-2d-profiler")&&(J().info("I.1","_createFlowFieldFromData (ms)",Math.round(i-r)),J().info("I.2","_getStreamlines (ms)",Math.round(o-i)),J().info("I.3","createAnimatedLinesData (ms)",Math.round(c-o)),J().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(d-c)),J().info("I.5","createFlowMesh (ms)",Math.round(d-r)),J().info("I.6","Mesh size (bytes)",f.vertexData.buffer.byteLength+f.indexData.buffer.byteLength)),await Promise.resolve(),qt(l),f}function ge(t,e){const n=ye(e.data,e.width,e.height,t.smoothing);return t.interpolate?(l,r)=>{const s=Math.floor(l),i=Math.floor(r);if(s<0||s>=e.width)return[0,0];if(i<0||i>=e.height)return[0,0];const h=l-s,o=r-i,a=s,c=i,f=s<e.width-1?s+1:s,d=i<e.height-1?i+1:i,u=n[2*(c*e.width+a)],p=n[2*(c*e.width+f)],g=n[2*(d*e.width+a)],m=n[2*(d*e.width+f)],w=n[2*(c*e.width+a)+1],y=n[2*(c*e.width+f)+1];return[(u*(1-o)+g*o)*(1-h)+(p*(1-o)+m*o)*h,(w*(1-o)+n[2*(d*e.width+a)+1]*o)*(1-h)+(y*(1-o)+n[2*(d*e.width+f)+1]*o)*h]}:(l,r)=>{const s=Math.round(l),i=Math.round(r);return s<0||s>=e.width||i<0||i>=e.height?[0,0]:[n[2*(i*e.width+s)],n[2*(i*e.width+s)+1]]}}function xe(t,e,n,l,r,s,i,h,o){const a=[];let c=n,f=l,d=0,[u,p]=e(c,f);u*=t.velocityScale,p*=t.velocityScale;const g=Math.sqrt(u*u+p*p);let m,w;a.push({x:c,y:f,t:d,speed:g});for(let y=0;y<t.verticesPerLine;y++){let[M,k]=e(c,f);M*=t.velocityScale,k*=t.velocityScale;const x=Math.sqrt(M*M+k*k);if(x<t.minSpeedThreshold)return a;const A=M/x,U=k/x;if(c+=A*t.segmentLength,f+=U*t.segmentLength,d+=t.segmentLength/x,Math.acos(A*m+U*w)>t.maxTurnAngle)return a;if(t.collisions){const b=Math.round(c*o),P=Math.round(f*o);if(b<0||b>i-1||P<0||P>h-1)return a;const $=s[P*i+b];if($!==-1&&$!==r)return a;s[P*i+b]=r}a.push({x:c,y:f,t:d,speed:x}),m=A,w=U}return a}function we(t,e,n,l){const r=[],s=new Ut,i=1/Math.max(t.lineCollisionWidth,1),h=Math.round(n*i),o=Math.round(l*i),a=new Int32Array(h*o);for(let f=0;f<a.length;f++)a[f]=-1;const c=[];for(let f=0;f<l;f+=t.lineSpacing)for(let d=0;d<n;d+=t.lineSpacing)c.push({x:d,y:f,sort:s.getFloat()});c.sort(((f,d)=>f.sort-d.sort));for(const{x:f,y:d}of c)if(s.getFloat()<t.density){const u=xe(t,e,f,d,r.length,a,h,o,i);if(u.length<2)continue;r.push(u)}return r}function ye(t,e,n,l){if(l===0)return t;const r=Math.round(3*l),s=new Array(2*r+1);let i=0;for(let a=-r;a<=r;a++){const c=Math.exp(-a*a/(l*l));s[a+r]=c,i+=c}for(let a=-r;a<=r;a++)s[a+r]/=i;const h=new Float32Array(t.length);for(let a=0;a<n;a++)for(let c=0;c<e;c++){let f=0,d=0;for(let u=-r;u<=r;u++){if(c+u<0||c+u>=e)continue;const p=s[u+r];f+=p*t[2*(a*e+(c+u))],d+=p*t[2*(a*e+(c+u))+1]}h[2*(a*e+c)]=f,h[2*(a*e+c)+1]=d}const o=new Float32Array(t.length);for(let a=0;a<e;a++)for(let c=0;c<n;c++){let f=0,d=0;for(let u=-r;u<=r;u++){if(c+u<0||c+u>=n)continue;const p=s[u+r];f+=p*h[2*((c+u)*e+a)],d+=p*h[2*((c+u)*e+a)+1]}o[2*(c*e+a)]=f,o[2*(c*e+a)+1]=d}return o}function ke(t,e){const n=new Ut,l=t.reduce(((o,a)=>o+a.length),0),r=new Float32Array(4*l),s=new Array(t.length);let i=0,h=0;for(const o of t){const a=i;for(const c of o)r[4*i]=c.x,r[4*i+1]=c.y,r[4*i+2]=c.t,r[4*i+3]=c.speed,i++;s[h++]={startVertex:a,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:n.getFloat()}}return{lineVertices:r,lineDescriptors:s}}function Me(t,e){const{lineVertices:l,lineDescriptors:r}=t;let s=0,i=0;for(const u of r)s+=2*u.numberOfVertices,i+=6*(u.numberOfVertices-1);const h=new Float32Array(s*9),o=new Uint32Array(i);let a=0,c=0;function f(){o[c++]=a-2,o[c++]=a,o[c++]=a-1,o[c++]=a,o[c++]=a+1,o[c++]=a-1}function d(u,p,g,m,w,y,M,k){const x=a*9;let A=0;h[x+A++]=u,h[x+A++]=p,h[x+A++]=1,h[x+A++]=g,h[x+A++]=y,h[x+A++]=M,h[x+A++]=m/2,h[x+A++]=w/2,h[x+A++]=k,a++,h[x+A++]=u,h[x+A++]=p,h[x+A++]=-1,h[x+A++]=g,h[x+A++]=y,h[x+A++]=M,h[x+A++]=-m/2,h[x+A++]=-w/2,h[x+A++]=k,a++}for(const u of r){const{totalTime:p,timeSeed:g}=u;let m=null,w=null,y=null,M=null,k=null,x=null;for(let A=0;A<u.numberOfVertices;A++){const U=l[4*(u.startVertex+A)],b=l[4*(u.startVertex+A)+1],P=l[4*(u.startVertex+A)+2],$=l[4*(u.startVertex+A)+3];let T=null,v=null,B=null,_=null;if(A>0){T=U-m,v=b-w;const S=Math.sqrt(T*T+v*v);if(T/=S,v/=S,A>1){let I=T+k,C=v+x;const V=Math.sqrt(I*I+C*C);I/=V,C/=V;const E=Math.min(1/(I*T+C*v),e);I*=E,C*=E,B=-C,_=I}else B=-v,_=T;B!==null&&_!==null&&(d(m,w,y,B,_,p,g,$),f())}m=U,w=b,y=P,k=T,x=v,M=$}d(m,w,y,-x,k,p,g,M)}return{vertexData:h,indexData:o}}function Ae(t){const{lineVertices:r,lineDescriptors:s}=t;let i=0,h=0;for(const S of s){const I=S.numberOfVertices-1;i+=4*I*2,h+=6*I*2}const o=new Float32Array(i*16),a=new Uint32Array(h);let c,f,d,u,p,g,m,w,y,M,k,x,A,U,b=0,P=0;function $(){a[P++]=b-8,a[P++]=b-7,a[P++]=b-6,a[P++]=b-7,a[P++]=b-5,a[P++]=b-6,a[P++]=b-4,a[P++]=b-3,a[P++]=b-2,a[P++]=b-3,a[P++]=b-1,a[P++]=b-2}function T(S,I,C,V,E,O,L,G,W,X,tt,K,nt,it){const D=b*16;let R=0;for(const ht of[1,2])for(const _t of[1,2,3,4])o[D+R++]=S,o[D+R++]=I,o[D+R++]=C,o[D+R++]=V,o[D+R++]=L,o[D+R++]=G,o[D+R++]=W,o[D+R++]=X,o[D+R++]=ht,o[D+R++]=_t,o[D+R++]=nt,o[D+R++]=it,o[D+R++]=E/2,o[D+R++]=O/2,o[D+R++]=tt/2,o[D+R++]=K/2,b++}function v(S,I){let C=y+k,V=M+x;const E=Math.sqrt(C*C+V*V);C/=E,V/=E;const O=y*C+M*V;C/=O,V/=O;let L=k+A,G=x+U;const W=Math.sqrt(L*L+G*G);L/=W,G/=W;const X=k*L+x*G;L/=X,G/=X,T(c,f,d,u,-V,C,p,g,m,w,-G,L,S,I),$()}function B(S,I,C,V,E,O){if(y=k,M=x,k=A,x=U,y==null&&M==null&&(y=k,M=x),p!=null&&g!=null){A=S-p,U=I-g;const L=Math.sqrt(A*A+U*U);A/=L,U/=L}y!=null&&M!=null&&v(E,O),c=p,f=g,d=m,u=w,p=S,g=I,m=C,w=V}function _(S,I){y=k,M=x,k=A,x=U,y==null&&M==null&&(y=k,M=x),y!=null&&M!=null&&v(S,I)}for(const S of s){c=null,f=null,d=null,u=null,p=null,g=null,m=null,w=null,y=null,M=null,k=null,x=null,A=null,U=null;const{totalTime:I,timeSeed:C}=S;for(let V=0;V<S.numberOfVertices;V++)B(r[4*(S.startVertex+V)],r[4*(S.startVertex+V)+1],r[4*(S.startVertex+V)+2],r[4*(S.startVertex+V)+3],I,C);_(I,C)}return{vertexData:o,indexData:a}}function bt(t,e){const n=e.pixels,{width:l,height:r}=e,s=new Float32Array(l*r*2),i=e.mask||new Uint8Array(l*r*2);if(e.mask||i.fill(255),t==="vector-uv")for(let h=0;h<l*r;h++)s[2*h]=n[0][h],s[2*h+1]=-n[1][h];else if(t==="vector-magdir")for(let h=0;h<l*r;h++){const o=n[0][h],a=Wt(n[1][h]),c=Math.cos(a-Math.PI/2),f=Math.sin(a-Math.PI/2);s[2*h]=c*o,s[2*h+1]=f*o}return{data:s,mask:i,width:l,height:r}}async function Ye(t,e,n,l,r,s){const i=performance.now(),h=Gt(e.spatialReference);if(!h){const k=await vt(t,e,n,l,r,s);return et("esri-2d-profiler")&&J().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-i)),et("esri-2d-profiler")&&J().info("I.9","Number of parts",1),k}const[o,a]=h.valid,c=a-o,f=Math.ceil(e.width/c),d=e.width/f,u=Math.round(n/f);let p=e.xmin;const g=[],m=performance.now();for(let k=0;k<f;k++){const x=new Ot({xmin:p,xmax:p+d,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});g.push(vt(t,x,u,l,r,s)),p+=d}const w=await Promise.all(g);et("esri-2d-profiler")&&J().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-m)),et("esri-2d-profiler")&&J().info("I.9","Number of parts",w.length);const y={data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l};let M=0;for(const k of w){for(let x=0;x<k.height;x++)for(let A=0;A<k.width;A++)M+A>=n||(y.data[2*(x*n+M+A)]=k.data[2*(x*k.width+A)],y.data[2*(x*n+M+A)+1]=k.data[2*(x*k.width+A)+1],y.mask[x*n+M+A]=k.mask[x*k.width+A]);M+=k.width}return et("esri-2d-profiler")&&J().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-i)),y}async function vt(t,e,n,l,r,s){const i={requestProjectedLocalDirections:!0,signal:s};if(r!=null&&(i.timeExtent=r),t.type==="imagery"){await t.load({signal:s});const o=await t.internalFetchImage(e,n,l,i);return o?.pixelData?.pixelBlock==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:bt(t.rasterInfo.dataType,o.pixelData.pixelBlock)}await t.load({signal:s});const h=await t.fetchPixels(e,n,l,i);return h?.pixelBlock==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:bt(t.serviceRasterInfo.dataType,h.pixelBlock)}export{gt as A,je as B,wt as C,We as D,Ne as E,Le as F,Pt as G,De as H,Ge as I,_e as J,Ue as K,Re as M,Oe as R,Ke as S,ie as T,Ee as U,It as W,de as _,Ye as a,He as b,F as c,at as d,dt as e,At as f,Ie as g,$t as h,$e as i,qe as j,lt as k,Ct as l,Xe as m,Fe as n,Ve as o,Je as p,Ce as q,N as r,Qe as s,Se as t,ze as u,Te as v,Pe as w,Qt as x,Be as y,xt as z};
