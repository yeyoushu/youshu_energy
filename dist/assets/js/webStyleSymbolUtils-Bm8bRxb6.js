import{c as T,a as g}from"./devEnvironmentUtils-CB8wlU_f.js";import{E as N,I as c,s as p,fC as d,hF as U,hc as C,hI as w,hJ as S}from"./test-DMnSxVQs.js";import{u as D}from"./jsonUtils-8wfeekkP.js";import{p as $,m as F,i as j,y as x,h as A}from"./styleUtils-BLaqcVJr.js";import"./index-BJQUWR-1.js";import"./vendor-CHjNVy30.js";import"./station-DfQHTTxy.js";import"./defaults3D-BelXX9Kz.js";import"./defaults-CxYRXl92.js";import"./defaultsJSON-GKolV7NZ.js";const J=["web-gltf","web","cim"];function X(e,t,l){const o=e.name;return o==null?Promise.reject(new p("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName==="Esri2DPointSymbolsStyle"?W(o,t,l):j(e,t,l).then((r=>R(r,o,t,x,l)))}function M(e,t){return t.items.find((l=>l.name===e))}async function R(e,t,l,o,r){const n=l?.portal!=null?l.portal:N.getDefault(),s={portal:n,url:c(e.baseUrl)},m=M(t,e.data);if(!m)throw new p("symbolstyleutils:symbol-name-not-found",`The symbol name '${t}' could not be found`,{symbolName:t});const u=r?.acceptedFormats??J,b=o(m,u);if(!b)throw new p("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${t}' does not have an accepted format (one of ${u})`,{symbolName:t});const{url:v,format:E}=b;let i=d(v,s),y=m.thumbnail?.href??null;const f=m.thumbnail?.imageData;T()&&(i=g(i)??"",y=g(y));const I={portal:n,url:c(U(i)),origin:"portal-item"};return $(i,r).then((h=>{const O=E==="cim"?F(h.data):h.data,a=D(O,I);if(a&&C(a)){if(y){const P=d(y,s);a.thumbnail=new w({url:P})}else f&&(a.thumbnail=new w({url:`data:image/png;base64,${f}`}));e.styleUrl?a.styleOrigin=new S({portal:l.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(a.styleOrigin=new S({portal:l.portal,styleName:e.styleName,name:t}))}return a}))}function W(e,t,l){const o=A.replaceAll(/\{SymbolName\}/gi,e),r=t.portal!=null?t.portal:N.getDefault();return $(o,l).then((n=>{const s=F(n.data);return D(s,{portal:r,url:c(U(o)),origin:"portal-item"})}))}export{R as fetchSymbolFromStyle,M as getStyleItemFromStyle,X as resolveWebStyleSymbol};
